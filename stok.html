<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kelola Stok Obat</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f2f2f2;
      padding: 30px;
    }
    .card {
      max-width: 1000px;
      margin: auto;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }
    table {
      margin-top: 20px;
    }
    td input {
      width: 100%;
      border: none;
      background: transparent;
    }
  </style>
</head>
<body>

<div class="card">
  <h3 class="mb-4">Kelola Stok Obat</h3>

  <!-- Form tambah obat -->
  <form id="formTambah" class="row g-3 mb-4">
    <div class="col-md-3">
      <input type="text" class="form-control" placeholder="Nama Obat" id="nama" required>
    </div>
    <div class="col-md-2">
      <input type="text" class="form-control" placeholder="Tipe" id="tipe" required>
    </div>
    <div class="col-md-2">
      <input type="number" class="form-control" placeholder="Stok" id="stok" required>
    </div>
    <div class="col-md-3">
      <input type="number" class="form-control" placeholder="Harga" id="harga" required>
    </div>
    <div class="col-md-2">
      <button class="btn btn-success w-100">+ Tambah</button>
    </div>
  </form>

  <!-- Tabel data obat -->
  <table class="table table-bordered bg-white">
    <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Nama Obat</th>
        <th>Tipe</th>
        <th>Stok</th>
        <th>Harga</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="tabelStok"></tbody>
  </table>

  <a href="index.html" class="btn btn-secondary mt-3">‚Üê Kembali ke Dashboard</a>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzlE4tSu46RliN1cnGPhMoI1GCt7jjgdJJjQQbDOETnO6g12E-wrVJwDhTlg8d0PBRs/exec"; // ganti dengan URL kamu

document.getElementById("formTambah").addEventListener("submit", async function(e) {
  e.preventDefault();
  const nama = document.getElementById("nama").value;
  const tipe = document.getElementById("tipe").value;
  const stok = document.getElementById("stok").value;
  const harga = document.getElementById("harga").value;

  const formData = new FormData();
  formData.append("action", "tambahObat");
  formData.append("nama", nama);
  formData.append("tipe", tipe);
  formData.append("stok", stok);
  formData.append("harga", harga);

  const res = await fetch(scriptURL, {
    method: "POST",
    body: formData
  });

  const result = await res.text();
  if (result === "success") {
    alert("Obat berhasil ditambahkan!");
    loadStok();
    document.getElementById("formTambah").reset();
  } else {
    alert("Gagal menambahkan: " + result);
  }
});

async function loadStok() {
  const res = await fetch(`${scriptURL}?action=getStok`);
  const data = await res.json();
  const tbody = document.getElementById("tabelStok");
  tbody.innerHTML = "";
  data.slice(1).forEach((row, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td><input value="${row[1]}" onchange="updateObat(${i+2}, 2, this.value)" /></td>
      <td><input value="${row[2]}" onchange="updateObat(${i+2}, 3, this.value)" /></td>
      <td><input value="${row[3]}" onchange="updateObat(${i+2}, 4, this.value)" /></td>
      <td><input value="${row[4]}" onchange="updateObat(${i+2}, 5, this.value)" /></td>
      <td><button class="btn btn-danger btn-sm" onclick="hapusObat(${i+2})">Hapus</button></td>
    `;
    tbody.appendChild(tr);
  });
}

async function updateObat(baris, kolom, nilai) {
  const formData = new FormData();
  formData.append("action", "updateObat");
  formData.append("baris", baris);
  formData.append("kolom", kolom);
  formData.append("nilai", nilai);

  await fetch(scriptURL, {
    method: "POST",
    body: formData
  });
}

async function hapusObat(baris) {
  if (!confirm("Yakin ingin menghapus obat ini?")) return;
  const formData = new FormData();
  formData.append("action", "hapusObat");
  formData.append("baris", baris);

  await fetch(scriptURL, {
    method: "POST",
    body: formData
  });
  loadStok();
}

loadStok();
</script>

</body>
</html>
